# Whole-Drawer Imaging
## Camera and Lighting

<img height="500" alt="image" src="https://github.com/user-attachments/assets/7d78aed6-f65e-4b75-b30e-2625a0e2c516" />

**Figure S1.** GIGAMacro Magnify2 imaging rig at the FMNH


Our GIGAMacro Magnify2 system (Fig. S1) is set up to use a Canon EOS R5 camera with an Opto Engineering TC16M080 Telecentric lens (35mm, 0.463x magnification, F-mount). The telecentric lens prevents parallax and ensures that the final stacked and stitched image is free of warping or artifacts. For lighting, we use a Yongnuo YN24EX Macro Flash system, along with two cross-polarizing filters and a drop-in circular polarizer to reduce glare, and a cylinder of diffuser paper around the lens. The flashes are attached to the GIGAMacro’s adjustable arms for easy positioning.

## Scale Bar, Color Standard, and Filler Objects

Each whole-drawer image includes a ruler or scale bar and color standard. With a fixed telecentric lens, the ratio of pixel to real length is constant, but we include the scale bar for redundancy should the image and its metadata be ever separated. The GIGAMacro Magnify2 system also outputs a metadata file that can be used to calculate size based on the camera’s field of view, number of images taken, and percent image overlap. With our default camera and lens set-up, the average pixel:mm ratio is 106.63 (+/- 0.81) to 1.

For the color standard, there are many options, but the ColorChecker® series (Calibrite, USA, https://calibrite.com) is commonly used for biological imaging. These usually cost between $100-$200 depending on the version. While we initially used the larger "passport" version, we have since switched to the more compact "nano" version to minimize the image footprint. Including a color standard allows for color correction in downstream steps, ensuring that variation in specimen color reflects specimen differences rather than lighting discrepancies.

The final type of object we include in drawer images is the filler object. The GIGAMacro Magnify2 system works by capturing a series of images across the X, Y, and Z axes, then stacking on the Z axis and stitching the rows and columns together across the X and Y axes. Stitching using PTGui (https://ptgui.com/) and other common programs may fail when images include large featureless areas. To combat this, we add filler objects to any large areas of blank space within the trays. Anything small, irregularly shaped, and easy to maneuver should work as a filler object; we use sewing pins with brightly colored pinheads, as well as pinned pieces of cork. Additionally, in order to stitch the images together, GIGAMacro requires some vertical and horizontal overlap in each X-Y position. This occasionally adds a strip of extra space around the borders of the image, which is difficult for PTGui to stitch automatically. So, we also add framing fillers around the right and bottom sides of the unit trays, which are simply upside-down unit trays covered in colorful stickers. Both types of filler objects are generally ignored or filtered out by later computer vision steps in the DrawerDissect pipeline.

## Image Creation

Imaging the contents of a whole drawer takes between 15 and 45 minutes depending on the number of trays. To create the final image, the original photos are focus-stacked, and then those stacked photos are stitched together. Stacking and stitching is done automatically via the GIGAMacroFlow program, which comes pre-installed with the GIGAMacro imaging system. Zerenestacker and PTGui are called for stacking and stitching, respectively, by GIGAMacroFlow. Before the image is stitched, we use Adobe Lightroom to calibrate the stacked images based on the color standard for that drawer. Stacking and stitching, together, take approximately as long as the initial imaging. Color-correcting takes ~30-40 seconds per drawer. These processes may be run asynchronously, benefiting from small teams working in parallel.  We find that a small, 2- or 3-person team works best for efficient precuration, imaging, and image processing in parallel across two workstations.

The GIGAMacro Magnify2 system can output images as JPG, 8-bit/16-bit TIF, or in the camera’s RAW format. RAW images are normally ideal for color analysis as they include raw sensor outputs, but this may not be a feasible format for most users. One constraint is storage, with a single stitched image in JPG format using about 1GB, which increases to ~6GB for 8-bit TIFs, and ~30GB for RAW files from a Canon 5D camera. Processing time also increases with image size. Finally, RAW formats are not as widely supported as other image formats. In particular, they are unsupported by the automated stacking/stitching workflow offered by GIGAMacro, increasing training requirements for operators. Therefore, while RAW images could technically be used, we believe that 8-bit TIFs strike the best balance between image quality, file size, and processing efficiency.
